var pagePoint=function(){var e={},t=function(t){e=$.extend(e,t)},n=function(e){$.get("/user/getpointlist",{page:e||1},function(e){var t=["<table><tr><th width=210>\u65f6\u95f4</th><th width=210>\u6536\u5165/\u652f\u51fa</th><th width=210>\u8bd5\u7528\u79ef\u5206\u660e\u7ec6</th></tr>"];if(e&&e.page_data&&e.page_info.count>0){var i=e.page_data;$.each(i,function(e,n){t.push("<tr><td>"+n.createtime+"</td>"+(n.num>0?'<td class="point-add">+':'<td class="point-lose">')+n.num+"</td><td>"+r(n)+"</td></tr>")}),t.push('</table><div class="history-pagebar"></div>'),$(".history-detail").html(t.join(""));var s=e.page_info;if(s&&s.pnum>1){var o=new qikoo.widget.pagebar;o.init({currpage:s.page,totalpage:s.pnum,element:".history-detail .history-pagebar",onChange:function(e){n(e)}})}}else $(".history-detail").html('<div style="text-align:center">\u6682\u65e0\u6570\u636e</div>')},"json")},r=function(e){var t="";return e.strategy==1?t="\u53c2\u52a0\u514d\u8d39\u8bd5\u7528\u7b2c"+e.note.season+"\u671f\u5956\u52b1\u8bd5\u7528\u79ef\u5206":e.strategy==2?t="\u514d\u8d39\u8bd5\u7528\u7b2c"+e.note.season+"\u671f\u5206\u4eab\u5fae\u535a\u5956\u52b1\u8bd5\u7528\u79ef\u5206":t=e.summary,t},i=function(e){$.get("/user/getpurchaselist",{page:e||1},function(e){var n=['<table><tr><th width="270">\u5546\u54c1</th><th width="120">\u5151\u6362\u4ef7\u683c</th><th width="190">\u72b6\u6001</th><th>\u64cd\u4f5c</th></tr>'];if(e&&e.page_data&&e.page_info.count>0){var r=e.page_data;t(r);var s=e.purchase_products||{};$.each(r,function(e,t){var r=s[t.season][t.item_id];n.push(['<tr class="kubi-exchange-line">','<td class="product-info">','<img src="'+r.img+'">',"<span>"+r.name+"</span>","</td>","<td>",r.spend+"\u8bd5\u7528\u79ef\u5206","</td>","<td>",["\u5151\u6362\u6210\u529f","\u6b63\u5728\u914d\u8d27","\u5df2\u53d1\u8d27"][t.status],"</td>","<td>",t.address?'<a href="#" onclick="return false;" class="order-detail" data-id="'+t._id+'" >\u67e5\u770b\u8be6\u60c5>></a>':'<a class="link-addr" href="/activity/rushingaddr?id='+t._id+'">\u586b\u5199\u6536\u8d27\u5730\u5740>></a>',"</td>","</tr>"].join(""))}),n.push('</table><div class="history-pagebar"></div>'),$(".history-exchange").html(n.join(""));var o=e.page_info;if(o&&o.pnum>1){var u=new qikoo.widget.pagebar;u.init({currpage:o.page,totalpage:o.pnum,element:".history-exchange .history-pagebar",onChange:function(e){i(e)}})}}else $(".history-tab [data-tab=detail]").trigger("click"),$(".history-exchange").html('<div style="text-align:center">\u6682\u65e0\u6570\u636e</div>')},"json")},s=function(){$(".history-tab").click(function(e){var t=$(e.target),r=t.attr("data-tab");r&&($(".history-tab a").removeClass("tab-curr"),t.parent().addClass("tab-curr"),$(".history-detail,.history-exchange").hide(),$(".history-"+r).show(),r=="detail"&&$(".history-detail").attr("data-hasdata")!=1&&(n(1),$(".history-detail").attr("data-hasdata",1)))}),$(".history-exchange").on("click",".order-detail",function(t){var n=$(t.target).attr("data-id"),r=e[n],i;r.item_id=="qqqqqqqqqqqqqqqqqqqqqqqq"?i=['<div class="mod-exchange-dialog-bg"></div>','<div class="mod-exchange-dialog-bizhong">','<img src="http://p0.qhmsg.com/t01e9c7e3a89ec355bb.png">',"</div>"].join(""):i=['<div class="mod-exchange-dialog-bg"></div>','<div class="mod-exchange-dialog">','<div class="exchange-detail-title">\u8ba2\u5355\u8be6\u7ec6\u4fe1\u606f</div>',"<p><span>\u4e0b\u5355\u65f6\u95f4\uff1a</span>"+r.order_time+"</p>","<p><span>\u59d3\u540d\uff1a</span>"+r.realname+"</p>","<p><span>\u6536\u8d27\u5730\u5740\uff1a</span>"+r.province+r.city+r.county+r.address+"</p>","<p><span>\u8054\u7cfb\u65b9\u5f0f\uff1a</span>"+r.mobile+"</p>",'<a href="#" onclick="return false;" class="exchange-dialog-ok">\u786e\u8ba4</a>','<a href="#" onclick="return false;" class="exchange-dialog-close"></a>',"</div>"].join("");var s=$(i).appendTo("body");s.find(".exchange-dialog-close,.exchange-dialog-ok").click(function(){s.remove()}),$(".mod-exchange-dialog-bizhong,.mod-exchange-dialog-bg").click(function(){s.remove()})})},o=function(){s(),i(1)};return{init:o}}();