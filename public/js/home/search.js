(function(){var e=20,t=5,n="/search/q",r=searchHost,i=function(e){return e=e.toString(),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#39;"),e},s=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return n!=null?unescape(n[2]):null},o=function(e,t){var i=$.extend({},t);i.q=i.q===undefined?"*":i.q;var s=i.q;if(e=="api")var o=utils.path.encodeQueryJson(i),u=[r,n,"?",o].join("");else var o=utils.path.encodeQueryJson(i),u=["/search/","?",o].join("");return u},u=function(){var e=this;template.helper("cate_sel",function(t,n,r){return e.querys[t]===undefined&&n==0?r:e.querys[t]==n?r:""}),template.helper("cate_link",function(t,n){var r=$.extend({},e.querys);return r[t]=n,delete r.page,n||delete r[t],o("url",r)}),template.helper("option_sel",function(t,n,r){return e.querys[t]===undefined&&n==0?r:e.querys[t]==n?r:""}),template.helper("option_link",function(t,n){var r=$.extend({},e.querys);return r[t]?r[t]+=";"+n:r[t]=n,delete r.page,n||delete r[t],o("url",r)}),template.helper("selected_link",function(t,n){var r=$.extend({},e.querys),i="",u="";return e.querys[t]&&(i=s(t),i.match(n+";")?(u=i.replace(n+";",""),r[t]=u):i.match(";"+n)?(u=i.replace(";"+n,""),r[t]=u):i.match(n)&&delete r[t]),o("url",r)}),template.helper("catePath_link",function(t,n){var r=$.extend({},e.querys);return r[t]=n,delete r.page,n||delete r[t],o("url",r)}),template.helper("sort_sel",function(t,n){return t===undefined?e.querys.sort===""||e.querys.sort===undefined||e.querys.sort==="weight"?n:"":e.querys.sort!==""&&e.querys.sort!==undefined?n:""}),template.helper("sort_link",function(t){var n=$.extend({},e.querys);return t==""?delete n.sort:n.sort=n.sort==="asc"?"desc":"asc",delete n.page,o("url",n)}),template.helper("sort_symbol",function(t,n,r){var i=$.extend({},e.querys);return i.sort===""||i.sort===undefined||i.sort==="weight"?t:"asc"==i["sort"]?n:r}),template.helper("stock_check",function(t){var n=$.extend({},e.querys);return n.stock===undefined||n.stock==="0"||n.stock===""?"":t}),template.helper("stock_lnk",function(){var t=$.extend({},e.querys);return t.stock===undefined||t.stock==="0"||t.stock===""?t.stock="1":delete t.stock,delete t.page,o("url",t)}),template.helper("price2yuan",function(e){var t=e/100;return Math.floor(t)===t?parseInt(t,10):t}),template.helper("sort_data_monitor",function(){var t=$.extend({},e.querys);return"asc"==t["sort"]?"data-monitor=home_paixu_sort2":"data-monitor=home_paixu_sort1"})},a=function(){this.state={},this.querys={};var e=this;$(this).bind("stateChange",function(){e.render()})};a.prototype={_renderList:function(){u.apply(this);var e=this;$(".list-container").removeClass("list-container-no-ret"),$(".breadcrumbs_box").html(template("tpl-breadcrumbs",this.state.search_list)),$(".filter-box").html(template("tpl-filters",this.state.search_list)),$(".filter-box").show(),$(".list-container").html(template("tpl-product-list",this.state.search_list)),$("img.lazy").lazyload({threshold:200});var t=utils.path.getFromHash("page");t=t<1?1:t;var n=Math.ceil(e.state.search_list.total/10);$(".clone-item").hide(),n<2?$(".pagelist").hide():($(".pagelist").show(),e._initPaginator(t)),filters.dealWithFindMoreVisible()},_renderNoData:function(){u.apply(this),$(".filter-box").hide(),$(".list-container").addClass("list-container-no-ret"),$(".breadcrumbs_box").html(template("tpl-breadcrumbs",this.state.search_list)),this.state.hot_list&&($(".list-container").html([template("tpl-no-ret"),template("tpl-hot-list",this.state.hot_list)]),$(".hotkeywords a").each(function(e,t){$(t).attr("href","/search/?q="+encodeURIComponent($(t).html()))}),$(".hotkeywords").show())},_getHotList:function(){var e,n=!1;return function(){var r=this;if(e){r.setState("hot_list",e);return}if(n)return;return n=!0,$.ajax({url:"/index/gethotlist"}).then(function(e){e=typeof e=="string"?$.parseJSON(e):e;if(0==e.errno){var n=e.data.length;n%t!=0&&n>t&&(e.data=e.data.slice(0,Math.floor(n/t)*t)),r.setState("hot_list",e)}}).always(function(){n=!1})}}(),_doSearch:function(e){var t=o("api",e),n=this,r=setTimeout(function(){$(".listwrap .layer").show()},200);$.ajax({url:t,dataType:"jsonp",timeout:5e3}).then(function(e){clearTimeout(r),$(".listwrap .layer").hide();var e=e;e=typeof e=="string"?$.parseJSON(e):e,e.errno?(n.setState("search_list",[]),n._getHotList()):e.data.list.length?n.setState("search_list",e.data):(n.setState("search_list",e.data),n._getHotList())},function(){n._getHotList(),$(".listwrap .layer").hide()}).always(function(){})},_initPaginator:function(t){if(this.paginatorInited===!0)return!1;var n=$.extend({},this.querys),r=this;kkpager.generPageHtml({pno:t,total:Math.ceil(r.state.search_list.total/e),totalRecords:r.state.search_list.total,mode:"click",isGoPage:!1,isShowCurrPage:!1,isShowTotalPage:!1,click:function(e){return n.page=e-1,this.selectPage(e),location.hash="#page="+e,$("html,body").animate({scrollTop:$(".listwrap").offset().top-6},500,"easeOutCubic",function(){r._doSearch(n)}),!1}}),this.paginatorInited=!0},getSearchList:function(){var e=utils.path.queryUrl(location.href);e.q=e.q===undefined?"*":e.q,this.querys=$.extend({},e);var t=e.q,n=setInterval(function(){$(".qowrds")&&(clearInterval(n),t==="*"?$(".qwords").html("\u5168\u90e8"):$(".qwords").html(i(t)))},50);if($("#__mall_search_kw__").val()==""&&this.querys["q"]!="*"){$("#__mall_search_kw__").val(this.querys.q);try{$("#__mall_search_kw__").focus(),$("#__mall_search_kw__").blur()}catch(r){}}this._doSearch(e)},setState:function(){var e=[].slice.call(arguments);if(e.length<1)return;e.length==1?this.state=e[0]:this.state[e[0]]=e[1],$(this).trigger("stateChange")},render:function(){this.state.search_list&&this.state.search_list.list&&this.state.search_list.list.length?this._renderList():this._renderNoData()}},window.ShopSearchEngine=new a})();